!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.avmoptimizer=t():e.avmoptimizer=t()}(window,function(){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){const s=n(1).AvmOptimizer;e.exports={AvmOptimizer:s}},function(e,t,n){!function(t){"use strict";function n(e,t,n="",s="",r=0,i={}){this.hexcode=e,this.opname=t,this.comment=n,this.args=s,this.objargs=i,this.size=1+s.length/2,this.byteline=r,this.jumpsFrom=[],this.callsFrom=[]}function s(){}n._construct=function(e,t,s="",r="",i=0,h={}){return new n(e,t,s,r,i,h)},n.prototype.toString=function(){return"("+this.byteline+":"+this.opname+":"+this.args+")"},n.printList=function(e){for(var t="[",n=0;n<e.length;n++)t+=e[n],n!=e.length-1&&(t+=",");return t+="]"},s._construct=function(){return new s},s.byteArray2ToInt16=function(e){return 2!=e.length?0:(e[0]<<8|e[1])<<16>>16},s.int16ToByteArray2=function(e){for(var t=(e>>>0).toString(16);t.length<4;)t="0"+t;for(;t.length>4;)t=t.substr(1,t.length);for(var n=[];n.length<2;)n.push(Number("0x"+t[0]+t[1])),t=t.substr(2,t.length);return n},s.littleHexStringToBigByteArray=function(e){if(4!=e.length)return[];for(var t=[];e.length>0;)t.push(Number("0x"+e[0]+e[1])),e=e.substr(2,e.length);return t.reverse(),t},s.bigByteArray2TolittleHexString=function(e){if(2!=e.length)return"";var t="",n=0;for(n=0;n<e.length;n++){var s=e[n].toString(16);1==s.length&&(s="0"+s),t=s+t}return t},s.getAVMFromList=function(e){var t="",n=0;for(n=0;n<e.length;n++)t+=e[n].hexcode+e[n].args;return t},s.parseOpcodeList=function(e,t,n=0){if(0!=e.length&&e.length%2!=1){var r=""+e[0]+e[1],i=e.length;e=e.substr(2,e.length),e=s.parseOpcode(r,e,t,n),s.parseOpcodeList(e,t,n+(i-e.length)/2)}},s.parseOpcode=function(e,t,r=[],i=0){var h=parseInt(e,16);if("00"==e)r.push(new n(e,"PUSH0","#An empty array of bytes is pushed onto the stack","",i));else if(h>=1&&h<=75){var u="# ",o=0,p="",a="";for(o=0;o<h;o++){var l=""+t[0]+t[1];t=t.substr(2,t.length),p+=l,(g=parseInt(l,16))>=32&&g<=126&&(a+=String.fromCharCode(g))}u+=a,r.push(new n(e,"PUSHBYTES"+h,u,p,i))}else if("4c"==e){var f=0,c=""+t[0]+t[1];t=t.substr(2,t.length),u="#"+(f=parseInt(c,16))+" bytes: ";p="";for(o=0;o<f;o++)p+=""+t[0]+t[1],t=t.substr(2,t.length);u+="# "+f+" bytes pushed onto the stack",r.push(new n(e,"PUSHDATA1",u,p,i))}else if("4d"==e){f=0,c=""+t[0]+t[1];t=t.substr(2,t.length),f=parseInt(c,16),c=""+t[0]+t[1],t=t.substr(2,t.length),u="#"+(f+=256*parseInt(c,16))+" bytes: ";p="";for(o=0;o<f;o++)p+=""+t[0]+t[1],t=t.substr(2,t.length);u+="# "+f+" bytes pushed onto the stack",r.push(new n(e,"PUSHDATA2",u,p,i))}else if("4e"==e){f=0,c=""+t[0]+t[1];t=t.substr(2,t.length),f=parseInt(c,16),c=""+t[0]+t[1],t=t.substr(2,t.length),f+=256*parseInt(c,16),c=""+t[0]+t[1],t=t.substr(2,t.length),f+=65536*parseInt(c,16),c=""+t[0]+t[1],t=t.substr(2,t.length),u="#"+(f+=16777216*parseInt(c,16))+" bytes: ";p="";for(o=0;o<f;o++)p+=""+t[0]+t[1],t=t.substr(2,t.length);u+="# "+f+" bytes pushed onto the stack",r.push(new n(e,"PUSHDATA4",u,p,i))}else if("4f"==e)r.push(new n(e,"PUSHM1","#The number -1 is pushed onto the stack.","",i));else if("51"==e)r.push(new n(e,"PUSH1","# The number 1 is pushed onto the stack.","",i));else if("52"==e)r.push(new n(e,"PUSH2","# The number 2 is pushed onto the stack.","",i));else if("53"==e)r.push(new n(e,"PUSH3","# The number 3 is pushed onto the stack.","",i));else if("54"==e)r.push(new n(e,"PUSH4","# The number 4 is pushed onto the stack.","",i));else if("55"==e)r.push(new n(e,"PUSH5","# The number 5 is pushed onto the stack.","",i));else if("56"==e)r.push(new n(e,"PUSH6","# The number 6 is pushed onto the stack.","",i));else if("57"==e)r.push(new n(e,"PUSH7","# The number 7 is pushed onto the stack.","",i));else if("58"==e)r.push(new n(e,"PUSH8","# The number 8 is pushed onto the stack.","",i));else if("59"==e)r.push(new n(e,"PUSH9","# The number 9 is pushed onto the stack.","",i));else if("5a"==e)r.push(new n(e,"PUSH10","# The number 10 is pushed onto the stack.","",i));else if("5b"==e)r.push(new n(e,"PUSH11","# The number 11 is pushed onto the stack.","",i));else if("5c"==e)r.push(new n(e,"PUSH12","# The number 12 is pushed onto the stack.","",i));else if("5d"==e)r.push(new n(e,"PUSH13","# The number 13 is pushed onto the stack.","",i));else if("5e"==e)r.push(new n(e,"PUSH14","# The number 14 is pushed onto the stack.","",i));else if("5f"==e)r.push(new n(e,"PUSH15","# The number 15 is pushed onto the stack.","",i));else if("60"==e)r.push(new n(e,"PUSH16","# The number 16 is pushed onto the stack.","",i));else if("61"==e)r.push(new n(e,"NOP","# Does nothing.","",i));else if("62"==e){u="# ";var w=""+t[0]+t[1]+t[2]+t[3];t=t.substr(4,t.length),u+=""+s.byteArray2ToInt16(s.littleHexStringToBigByteArray(w,i)),r.push(new n(e,"JMP",u,w,i))}else if("63"==e){u="# ";w=""+t[0]+t[1]+t[2]+t[3];t=t.substr(4,t.length),u+=""+s.byteArray2ToInt16(s.littleHexStringToBigByteArray(w,i)),r.push(new n(e,"JMPIF",u,w,i))}else if("64"==e){u="# ";w=""+t[0]+t[1]+t[2]+t[3];t=t.substr(4,t.length),u+=""+s.byteArray2ToInt16(s.littleHexStringToBigByteArray(w,i)),r.push(new n(e,"JMPIFNOT",u,w,i))}else if("65"==e){u="# ";w=""+t[0]+t[1]+t[2]+t[3];t=t.substr(4,t.length),u+=""+s.byteArray2ToInt16(s.littleHexStringToBigByteArray(w,i)),r.push(new n(e,"CALL",u,w,i))}else if("66"==e)r.push(new n(e,"RET","#","",i));else if("68"==e){u="# ",p=w=""+t[0]+t[1],t=t.substr(2,t.length);var b=parseInt(w,16);a="",o=0;for(o=0;o<b;o++){var g;l=""+t[0]+t[1];t=t.substr(2,t.length),p+=l,(g=parseInt(l,16))>=32&&g<=126&&(a+=String.fromCharCode(g))}u+=a,r.push(new n(e,"SYSCALL",u,p,i))}else if("67"==e||"69"==e){var d="";"69"==e&&(d="TAILCALL"),"67"==e&&(d="APPCALL");var m="";for(o=0;o<20;o++){var T=""+t[0]+t[1];t=t.substr(2,t.length),m+=T}r.push(new n(e,d,u,m,i))}else"6a"==e?r.push(new n(e,"DUPFROMALTSTACK","# clone top element from altstack to mainstack","",i)):"6b"==e?r.push(new n(e,"TOALTSTACK","# Puts the input onto the top of the alt stack. Removes it from the main stack.","",i)):"6c"==e?r.push(new n(e,"FROMALTSTACK","# Puts the input onto the top of the main stack. Removes it from the alt stack.","",i)):"6d"==e?r.push(new n(e,"XDROP","#","",i)):"72"==e?r.push(new n(e,"XSWAP","#","",i)):"73"==e?r.push(new n(e,"XTUCK","#","",i)):"74"==e?r.push(new n(e,"DEPTH","# Puts the number of stack items onto the stack.","",i)):"75"==e?r.push(new n(e,"DROP","# Removes the top stack item.","",i)):"76"==e?r.push(new n(e,"DUP","# Duplicates the top stack item.","",i)):"77"==e?r.push(new n(e,"NIP","# Removes the second-to-top stack item.","",i)):"78"==e?r.push(new n(e,"OVER","# Copies the second-to-top stack item to the top.","",i)):"79"==e?r.push(new n(e,"PICK","# The item n back in the stack is copied to the top.","",i)):"7a"==e?r.push(new n(e,"ROLL","# The item n back in the stack is moved to the top.","",i)):"7b"==e?r.push(new n(e,"ROT","# The top three items on the stack are rotated to the left.","",i)):"7c"==e?r.push(new n(e,"SWAP","# The top two items on the stack are swapped.","",i)):"7d"==e?r.push(new n(e,"TUCK","# The item at the top of the stack is copied and inserted before the second-to-top item.","",i)):"7e"==e?r.push(new n(e,"CAT","# Concatenates two strings.","",i)):"7f"==e?r.push(new n(e,"SUBSTR","# Returns a section of a string.","",i)):"80"==e?r.push(new n(e,"LEFT","# Keeps only characters left of the specified point in a string.","",i)):"81"==e?r.push(new n(e,"RIGHT","# Keeps only characters right of the specified point in a string.","",i)):"82"==e?r.push(new n(e,"SIZE","# Returns the length of the input string.","",i)):"83"==e?r.push(new n(e,"INVERT","# Flips all of the bits in the input.","",i)):"84"==e?r.push(new n(e,"AND","# Boolean and between each bit in the inputs.","",i)):"85"==e?r.push(new n(e,"OR","# Boolean or between each bit in the inputs.","",i)):"86"==e?r.push(new n(e,"XOR","# Boolean exclusive or between each bit in the inputs.","",i)):"87"==e?r.push(new n(e,"EQUAL","# Returns 1 if the inputs are exactly equal, 0 otherwise.","",i)):"8b"==e?r.push(new n(e,"INC","# 1 is added to the input.","",i)):"8c"==e?r.push(new n(e,"DEC","# 1 is subtracted from the input.","",i)):"8d"==e?r.push(new n(e,"SIGN","#","",i)):"8f"==e?r.push(new n(e,"NEGATE","# The sign of the input is flipped.","",i)):"90"==e?r.push(new n(e,"ABS","# The input is made positive.","",i)):"91"==e?r.push(new n(e,"NOT","# If the input is 0 or 1, it is flipped. Otherwise the output will be 0.","",i)):"92"==e?r.push(new n(e,"NZ","# Returns 0 if the input is 0. 1 otherwise.","",i)):"93"==e?r.push(new n(e,"ADD","# a is added to b.","",i)):"94"==e?r.push(new n(e,"SUB","# b is subtracted from a.","",i)):"95"==e?r.push(new n(e,"MUL","# a is multiplied by b.","",i)):"96"==e?r.push(new n(e,"DIV","# a is divided by b.","",i)):"97"==e?r.push(new n(e,"MOD","# Returns the remainder after dividing a by b.","",i)):"98"==e?r.push(new n(e,"SHL","# Shifts a left b bits, preserving sign.","",i)):"99"==e?r.push(new n(e,"SHR","# Shifts a right b bits, preserving sign.","",i)):"9a"==e?r.push(new n(e,"BOOLAND","# If both a and b are not 0, the output is 1. Otherwise 0.","",i)):"9b"==e?r.push(new n(e,"BOOLOR","# If a or b is not 0, the output is 1. Otherwise 0.","",i)):"9c"==e?r.push(new n(e,"NUMEQUAL","# Returns 1 if the numbers are equal, 0 otherwise.","",i)):"9e"==e?r.push(new n(e,"NUMNOTEQUAL","# Returns 1 if the numbers are not equal, 0 otherwise.","",i)):"9f"==e?r.push(new n(e,"LT","# Returns 1 if a is less than b, 0 otherwise.","",i)):"a0"==e?r.push(new n(e,"GT","# Returns 1 if a is greater than b, 0 otherwise.","",i)):"a1"==e?r.push(new n(e,"LTE","# Returns 1 if a is less than or equal to b, 0 otherwise.","",i)):"a2"==e?r.push(new n(e,"GTE","# Returns 1 if a is greater than or equal to b, 0 otherwise.","",i)):"a3"==e?r.push(new n(e,"MIN","# Returns the smaller of a and b.","",i)):"a4"==e?r.push(new n(e,"MAX","# Returns the larger of a and b.","",i)):"a5"==e?r.push(new n(e,"WITHIN","# Returns 1 if x is within the specified range (left-inclusive), 0 otherwise.","",i)):"a7"==e?r.push(new n(e,"SHA1","# The input is hashed using SHA-1.","",i)):"a8"==e?r.push(new n(e,"SHA256","# The input is hashed using SHA-256.","",i)):"a9"==e?r.push(new n(e,"HASH160","# The input is hashed using HASH160.","",i)):"aa"==e?r.push(new n(e,"HASH256","# The input is hashed using HASH256.","",i)):"ac"==e?r.push(new n(e,"CHECKSIG","#","",i)):"ae"==e?r.push(new n(e,"CHECKMULTISIG","#","",i)):"c0"==e?r.push(new n(e,"ARRAYSIZE","#","",i)):"c1"==e?r.push(new n(e,"PACK","#","",i)):"c2"==e?r.push(new n(e,"UNPACK","#","",i)):"c3"==e?r.push(new n(e,"PICKITEM","#","",i)):"c4"==e?r.push(new n(e,"SETITEM","#","",i)):"c5"==e?r.push(new n(e,"NEWARRAY","#","",i)):"c6"==e?r.push(new n(e,"NEWSTRUCT","#","",i)):"c8"==e?r.push(new n(e,"APPEND","#","",i)):"c9"==e?r.push(new n(e,"REVERSE","#","",i)):"ca"==e?r.push(new n(e,"REMOVE","#","",i)):"f0"==e?r.push(new n(e,"THROW","#","",i)):"f1"==e?r.push(new n(e,"THROWIFNOT","#","",i)):r.push(new n(e,"???","#","",i));return t},s.markJumpAt=function(e,t,n,s=!1,r=!1){for(var i=0;i<e.length;i++)e[i].byteline==t&&(s&&e[i].jumpsFrom.push(n),r&&e[i].callsFrom.push(n))},s.computeJumpsFrom=function(e){for(var t=0;t<e.length;t++)if("JMP"==e[t].opname||"JMPIF"==e[t].opname||"JMPIFNOT"==e[t].opname||"THROWIFNOT"==e[t].opname){var n=s.byteArray2ToInt16(s.littleHexStringToBigByteArray(e[t].args));s.markJumpAt(e,e[t].byteline+n,e[t].byteline,!0,!1)}else if("CALL"==e[t].opname){n=s.byteArray2ToInt16(s.littleHexStringToBigByteArray(e[t].args));s.markJumpAt(e,e[t].byteline+n,e[t].byteline,!1,!0)}},s.parseJumpList=function(e){for(var t=[],n=0;n<e.length;n++)t.push([e[n].byteline,e[n].opname,e[n].jumpsFrom,e[n].callsFrom]);return t},s.breakJumpModules=function(e){for(var t=e.slice(),n=[],s=0,r=0;r<t.length;r++)(t[r][2].length>0||t[r][3].length>0)&&(n.push(t.slice(s,r)),s=r);return s!=t.length&&n.push(t.slice(s,t.length)),n},s.breakAllJumpModules=function(e){for(var t=e.slice(),n=[],s=0,r=0;r<t.length;r++)(t[r][2].length>0||t[r][3].length>0)&&(n.push(t.slice(s,r)),s=r),"JMP"!=t[r][1]&&"JMPIF"!=t[r][1]&&"JMPIFNOT"!=t[r][1]&&"CALL"!=t[r][1]&&"THROWIFNOT"!=t[r][1]||(s!=r&&(n.push(t.slice(s,r)),s=r),n.push(t.slice(s,r+1)),s=r+1);return s!=t.length&&n.push(t.slice(s,t.length)),n},s.joinListModules=function(e){for(var t=[],n=0;n<e.length;n++)for(var s=0;s<e[n].length;s++)t.push(e[n][s]);return t},s.findOnArray=function(e,t){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1},s.findLineOnOplist=function(e,t){for(var n=0;n<t.length;n++)if(s.findOnArray(e,t[n][2])||s.findOnArray(e,t[n][3]))return t[n][0];return-1},s.generateFlowChartFromModules=function(e,t,n,r=!1){var i="";i+="input=>start: Start Script|past\nret=>end: RET|approved\nthrow=>end: THROW|rejected\nnone=>end: NONE|approved\n";for(var h=0;h<e.length;h++){var u=e[h].length-1;if(i+="Line"+e[h][0][0]+"=>",1!=e[h].length||"JMP"!=e[h][0][1]&&"JMPIF"!=e[h][0][1]&&"JMPIFNOT"!=e[h][0][1]&&"CALL"!=e[h][0][1]&&"THROWIFNOT"!=e[h][0][1]?i+="operation: ":i+="condition: ",r)i+=e[h][0][0]+":"+e[h][0][1],u>0&&(i+="..."+e[h][u][0]+":"+e[h][u][1]);else for(var o=0;o<e[h].length;o++)i+=e[h][o][0]+":"+e[h][o][1]+"\n";i+="|future\n"}i+="input->Line0\n";for(h=0;h<e.length;h++){u=e[h].length-1;if(1!=e[h].length||"JMP"!=e[h][0][1]&&"JMPIF"!=e[h][0][1]&&"JMPIFNOT"!=e[h][0][1]&&"CALL"!=e[h][0][1]&&"THROWIFNOT"!=e[h][0][1])i+="Line"+e[h][0][0]+"->","RET"==e[h][u][1]?i+="ret\n":"THROW"==e[h][u][1]?i+="throw\n":h==e.length-1?i+="none\n":i+="Line"+e[h+1][0][0]+"\n";else{i+="Line"+e[h][0][0]+"(no)->","RET"==e[h][u][1]?i+="ret\n":"THROW"==e[h][u][1]?i+="throw\n":h==e.length-1?i+="none\n":i+="Line"+e[h+1][0][0]+"\n",i+="Line"+e[h][0][0]+"(yes)->";var p=s.findLineOnOplist(e[h][0][0],t);i+=p<0?"ERROR_Line_Not_Found\n":"Line"+p+"\n"}}return i},e.exports={AvmOptimizer:s,NeoOpcode:n}}()}])});